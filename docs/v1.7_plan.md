# v1.7 MarqBot UI Revamp Implementation Plan

Planning artifact only. This document defines the v1.7 execution spec and does **not** imply implementation has started.

## Summary
Rebuild the Planner UI into a dashboard-style 5-part layout with a left vertical navigation rail and a 2x2 asymmetric workspace, while preserving all backend/API behavior and existing recommendation data fidelity.

## Locked Product Decisions
1. Left rail order: `Home`, `Planner`, `Courses`, `Saved`, `AI Advisor`, `Avatar`.
2. First-load behavior: restore last selected nav tab; fallback to `Planner`.
3. Planner state is preserved when switching tabs (inputs, chips, and results remain).
4. Rail style is text-only (no icons) with yellow active state and glow.
5. Rail branding remains visible at top: `marquette_logo.png` + `MarqBot`.
6. Main Planner grid uses 33/67 split (left/right) on desktop/tablet.
7. Recommendations panel shows one selected semester at a time.
8. Semester selector labels use `Semester N - Term`.
9. Semester selector column uses fixed narrow width (about 180-220px).
10. Modal is scrollable and shows full semester detail stack:
   - larger course cards
   - projected degree progress
   - timeline
   - existing notes/warnings
11. Modal closes by outside click, `Esc`, or close button.
12. No auto-scroll after recommendation submit.
13. Rail screen transitions are direction-aware vertical slide/fade.
14. Tablet keeps the full 5-part concept using a compact text-only rail; mobile (<900px) uses a bottom text+label tab bar.
15. Avatar uses same coming-soon behavior and reuses Saved cover art.
16. Existing key planner IDs/hooks must be preserved where possible.
17. Frontend testing target for v1.7 is full UI-focused suite expansion.
18. Documentation target: `docs/PROJECT_HISTORY.md` + this file.
19. Commit strategy: phased commits by module area.
20. Topbar is removed in v1.7; branding lives in the left rail.
21. Remove `updateStepIndicator()` ghost logic and related dead CSS.
22. Preserve can-take dual behavior (standalone Enter + `requested_course` in `/recommend` submit).
23. Keep current submit-button loading state (no recommendations skeleton in v1.7).

## Non-Negotiable Constraints
1. Preserve Marquette visual identity and existing translucent/background style language.
2. Keep recommendation data fidelity intact:
   - course code
   - course name
   - credits
   - bucket labels/count mappings
   - why recommended
   - prereq check
   - unlocks
   - warnings
3. Keep `/recommend` and `/can-take` API contracts stable.
4. No backend logic changes required for v1.7 unless strictly UI-plumbing-compatible.

---

## Stress-Test Findings & Gap Analysis

> Added 2026-02-22. Cross-referenced every section against the live codebase (`app.js`, `index.html`, `style.css`, `session.js`, `rendering.js`, `multiselect.js`, `utils.js`, and all test suites).

### GAP 1: Topbar-to-Rail Migration - Nav Pill Indicator Removal
**Current state:** `#topbar` contains an `<nav class="anchor-nav">` with a horizontally animated `#nav-pill-indicator` (`translateX`, `offsetWidth`). `setupAnchorNav()` (app.js:342-419) drives it.
**Gap:** The plan says "replace top nav with left rail" but does not specify:
- Whether `#topbar` is removed entirely or kept as a thin branding bar (logo only).
- What happens to the horizontal pill indicator animation - it must be deleted or replaced with a vertical equivalent; the current `translateX` / `offsetWidth` math is meaningless in a vertical rail.
- The `#nav-plan` element is currently an `<a href="#section-progress">` while all others are `<button>`. In a rail all items should be consistent element types.
**Decision locked:** Remove `#topbar` entirely for v1.7. Branding moves into the left rail header, and horizontal pill-indicator logic is removed.

### GAP 2: `placeholderMap` Needs Avatar Entry
**Current state:** `placeholderMap` in `setupAnchorNav()` (app.js:351-356) maps 4 nav IDs to placeholder screen IDs. There is no Avatar entry.
**Gap:** Plan adds `Avatar` to the rail (decision #1) but does not specify:
- The nav button ID for Avatar (suggest: `nav-avatar`).
- The placeholder screen ID (suggest: `placeholder-avatar`).
- The CSS class for the cover image (suggest: `.placeholder-screen--avatar`).
- The cover image source. Decision #15 says "reuses Saved cover art" -> `screen_saved_cover.jpg`. Must set `--placeholder-cover: url("screen_saved_cover.jpg")` on `.placeholder-screen--avatar`.
**Resolution:** Add explicit Avatar IDs/classes to the plan. Update `placeholderMap` to include `"nav-avatar": "placeholder-avatar"`.

### GAP 3: `form="advisor-form"` Attribute Binding Across Panels
**Current state:** `#target-semester`, `#target-semester-2`, `#target-semester-3`, `#max-recs` live in `#panel-right` but use `form="advisor-form"` to associate with the form in `#panel-left`. The form submit handler reads these values.
**Gap:** The 2x2 grid moves settings to "Bottom-left" quadrant. The `form` attribute binding will still work regardless of DOM position, but:
- If any settings element is moved into a different `<form>` or wrapped in a new form, the `form="advisor-form"` link breaks.
- The plan does not call out this binding or warn against wrapping settings in a new form element.
**Resolution:** Add explicit constraint: settings controls must keep `form="advisor-form"` attribute. No new `<form>` tags wrapping settings.

### GAP 4: Session Schema Migration for `activeNavTab`
**Current state:** Session uses `STORAGE_KEY = "marqbot_session_v1"` and stores a fixed schema. `restoreSession()` gracefully ignores unknown keys.
**Gap:** Plan says "extend session model with `activeNavTab`" but does not address:
- Whether the storage key changes (it should not - `v1` key with graceful fallback is fine).
- `restoreSession()` needs a code path to read `activeNavTab` and call `setActiveNav()` on the matching rail item. Currently `restoreSession` only restores form state; it has no hook for nav state.
- If the stored `activeNavTab` references a removed/renamed ID, the restore must fall back to `"nav-plan"`.
**Resolution:** Add to Phase 2:
- `getSessionSnapshot()` gains `activeNavTab` field.
- `restoreSession()` gains `callbacks.restoreNavTab(tabId)` callback.
- Fallback: if stored tab ID not found in DOM, default to `"nav-plan"`.

### GAP 5: `#step-indicator` Is Ghost Code
**Current state:** `updateStepIndicator()` (app.js:329-340) queries `#step-indicator .step` but no element with `id="step-indicator"` exists in `index.html`. The CSS at line 1396 hides `#topbar .step-indicator` on mobile. This is dead code.
**Gap:** Plan does not mention step indicator at all. Two choices:
1. Remove the ghost code during v1.7 cleanup.
2. Actually implement a step indicator in the new layout.
**Decision locked / Resolution:** Remove `updateStepIndicator()` and related `#topbar .step-indicator` CSS. No new step indicator is added in v1.7.

### GAP 6: Planner 2x2 Grid - Rendering Target IDs Must Move
**Current state:** Results inject into specific IDs:
- `#results` (center panel) - recommendation cards
- `#progress-dashboard`, `#progress-ring-wrap`, `#kpi-row` (center panel) - progress data
- `#right-summary`, `#right-summary-content` (right panel) - degree summary
- `#can-take-result` (right panel) - eligibility result
**Gap:** The 2x2 layout reassigns content:
- Top-right = Academic Dashboard -> needs `#progress-dashboard`, `#progress-ring-wrap`, `#kpi-row`
- Bottom-right = Recommendations -> needs `#results`
- Bottom-left = Settings + Can Take + Degree Summary -> needs `#can-take-section`, `#right-summary`, `#quick-settings`
**Plan does not specify** whether these IDs stay on the same elements (just repositioned in DOM) or whether new wrapper elements are needed. The safest approach: keep all existing IDs on the same elements, re-parent them into new grid quadrant containers.
**Resolution:** Add explicit ID preservation table mapping old parent -> new quadrant parent.

### GAP 7: `renderResults()` Currently Injects Into `#results` - No Semester Splitting
**Current state:** `renderRecommendationsHtml()` (rendering.js:376-411) returns one monolithic HTML string containing all semesters concatenated. `app.js` injects this into `#results.innerHTML`.
**Gap:** The v1.7 plan wants semester-by-semester selection (show one semester at a time with a selector). This requires:
- `renderRecommendationsHtml()` must be decomposed - each semester's HTML must be addressable separately.
- New function needed: something like `renderSemesterSelectorHtml()` for the left sub-column buttons.
- The "Plan Context" and "Current Progress" prefix block (lines 380-402 of rendering.js) must render once above the selector, not per-semester.
- Selected-semester state must track which semester index is active.
- When the response has only 1 semester, the selector is unnecessary - plan mentions this but rendering.js has no concept of it.
**Resolution:** Add to Phase 3 technical spec:
- Split `renderRecommendationsHtml` into: `renderRecsPrefixHtml(data)` + `renderSemesterSelectorHtml(semesters)` + reuse existing `renderSemesterHtml(data, index)`.
- `app.js` tracks `state.selectedSemesterIndex` (default 0).
- On selector click: re-render only the semester detail pane, not the entire results block.

### GAP 8: Modal Content - What Exactly Renders?
**Current state:** `renderSemesterHtml()` already produces: course cards + degree progress bars + timeline stats + warnings + double-counted courses + allocation notes. This is the "full semester detail stack."
**Gap:** Plan says modal shows "enlarged cards + progress + timeline + notes/warnings" but does not specify:
- Does the modal reuse `renderSemesterHtml()` output verbatim, or does it call a separate modal-specific renderer with larger sizing?
- If reusing the same function, how are "larger course cards" achieved? CSS-only scaling (`.modal .rec-card { ... }`) or a new `renderModalCard()` function?
- The modal content includes data that's already visible in the selected-semester pane. Is the pane a compact summary and the modal the full version? Or are they the same content at different scales?
**Resolution:** Recommend CSS-only approach: modal wraps the same `renderSemesterHtml()` output inside a `.modal-body` container; CSS rules like `.modal-body .rec-card` apply larger padding/font. No new render functions needed. Document this choice.

### GAP 9: Responsive Breakpoints - Rail Collapse Behavior Undefined
**Current state:** Three breakpoints: 1200px (right panel stacks), 900px (single column), 700px (mobile padding). The topbar is always visible.
**Gap:** Plan says "Tablet keeps the full 5-part concept; mobile may degrade gracefully" but does not define:
- At what breakpoint does the vertical rail collapse? A 180-220px rail on a 360px phone leaves 140-180px for content - unusable.
- Does the rail become a bottom tab bar on mobile? A hamburger menu? A horizontal scroll strip?
- What happens to the 2x2 planner grid on tablet (1200px)? Does it become 1-column stacked?
- The current 900px breakpoint makes all panels stack vertically. With a rail, this needs rethinking.
**Resolution:** Define explicit rail responsive behavior:
- Desktop (>1200px): Full vertical rail + 2x2 planner grid.
- Tablet (900-1200px): Rail stays vertical in compact text-only mode. Planner grid becomes single-column stack.
- Mobile (<900px): Rail collapses to a horizontal bottom tab bar with text+label items. Grid is single-column.
- Add breakpoint to plan.

### GAP 10: Multiselect Dropdowns - z-index and Overflow in New Grid
**Current state:** `.ms-dropdown` uses `position: absolute; z-index: 30`. Parent panels use `overflow-y: auto` (sticky side panels).
**Gap:** In the current 3-panel layout, dropdowns overflow within their sticky panel. In a 2x2 grid:
- If quadrant containers use `overflow: hidden` or `overflow: auto`, dropdowns will be clipped.
- The completed/IP course multiselects can have 12+ options - they need to overflow their quadrant boundary.
**Resolution:** Add to Phase 1: quadrant containers must not use `overflow: hidden`. Use `overflow: visible` on grid cells, or move dropdowns to a portal-style approach. Test dropdown visibility in all four quadrants.

### GAP 11: `#section-hero` (Welcome Header) - Where Does It Go?
**Current state:** `#section-hero` sits at the top of `#panel-center` and shows a welcome message before any results.
**Gap:** Plan does not mention the hero section. In the 2x2 grid, there's no obvious home for it. Options:
1. Remove it entirely (results area is self-explanatory).
2. Move it into the top-right quadrant as a pre-results placeholder.
3. Show it as an overlay/empty-state in the bottom-right recommendations area.
**Resolution:** Specify what happens to `#section-hero`. Recommend: show it as empty-state in the bottom-right recommendations quadrant; hide it once results load.

### GAP 12: `clearResults()` Must Be Updated for New Layout
**Current state:** `clearResults()` (app.js) hides `#progress-dashboard`, `#right-summary`, `#can-take-result`, clears `#results.innerHTML`.
**Gap:** With the new 2x2 layout:
- Progress dashboard is in top-right quadrant.
- Degree summary is in bottom-left quadrant.
- Can-take is in bottom-left quadrant.
- Results are in bottom-right quadrant.
- `clearResults()` must clear/reset all four quadrant-relevant states.
- Must also reset `state.selectedSemesterIndex` to 0.
- Must close modal if open.
**Resolution:** Extend `clearResults()` scope in Phase 3 spec.

### GAP 13: Keyboard Accessibility for Rail and Semester Selector
**Current state:** Multiselect has full keyboard support (Arrow, Enter, Escape). Anchor nav has no keyboard navigation beyond default button focus.
**Gap:** Plan specifies no keyboard behavior for:
- Rail navigation: Should arrow keys cycle through rail items?
- Semester selector: Should arrow keys switch semesters?
- Modal: Should focus be trapped inside the modal while open (accessibility best practice)?
**Resolution:** Add accessibility requirements:
- Rail: `role="tablist"`, items get `role="tab"`, `aria-selected`. Arrow keys cycle items.
- Semester selector: `role="tablist"` with arrow key support.
- Modal: Focus trap on open, restore focus to trigger element on close. `role="dialog"`, `aria-modal="true"`.

### GAP 14: Background Orbs and Grid - Positioning Under New Layout
**Current state:** Three decorative elements sit before `#topbar` in the DOM:
```html
<div class="bg-orb bg-orb-a"></div>
<div class="bg-orb bg-orb-b"></div>
<div class="bg-grid"></div>
```
These are `position: fixed` background decorations.
**Gap:** With a left rail replacing the topbar nav, the background grid and orbs may need re-positioning. The `inset: 0` on orbs means they cover the full viewport, which should still work - but the `bg-grid` may visually clash with a vertical rail.
**Resolution:** Test visual appearance after rail implementation. Note in Phase 5 that background layer adjustment may be needed.

### GAP 15: Test Breakage Inventory
**Current state:** `static_ui_contract.test.js` tests for:
- `marquette_logo.png` in the topbar
- Nav order: `nav-home`, `nav-plan`, `nav-courses`, `nav-saved`, `nav-ai-advisor`
- Placeholder screen IDs and CSS classes
- `.app-shell-hidden` class existence
- Cover image files on disk
**Gap:** v1.7 will break these tests because:
- Nav moves from topbar to rail -> tests checking topbar nav will fail.
- Avatar is a new nav item -> tests checking nav order need updating.
- `.app-shell-hidden` class may change if the hide/show mechanism changes with rail routing.
- New CSS classes for rail, grid quadrants, modal, and semester selector need test coverage.
**Resolution:** Phase 6 must include an explicit test update checklist:
- Update nav order tests to include Avatar.
- Update nav container selector (from `.anchor-nav` to `.rail-nav` or equivalent).
- Add tests for Avatar placeholder screen (`#placeholder-avatar`, `.placeholder-screen--avatar`).
- Add tests for modal container existence and close mechanism.
- Add tests for semester selector rendering.
- Preserve existing rendering.js tests unchanged (pure functions, no DOM dependency).

### GAP 16: `can-take-input` Double-Duty - Form Payload Leakage
**Current state:** `#can-take-input` is in the right panel. When the user types a course code and presses Enter, `setupCanTakeStandalone()` intercepts it and calls `postCanTake()`. But if the user presses the "Get Recommendations" button instead, the form submit handler reads `canTakeInput.value` and sends it as `requested_course` in the `/recommend` payload (app.js line 722).
**Gap:** Moving `#can-take-input` to the bottom-left quadrant (alongside settings) means it's still part of `form="advisor-form"` implicitly. The plan should clarify whether this dual behavior is preserved or if can-take becomes fully standalone (no leakage into `/recommend`).
**Resolution:** Document current dual behavior. If preserving it, ensure `#can-take-input` remains associated with `#advisor-form`. If separating it, remove the `requested_course` field from the form submit payload.

### GAP 17: Transition Direction Logic - Index-Based Math
**Current state:** Current placeholder transitions use `translateY(20px) scale(0.99)` -> `translateY(0) scale(1)` - same direction always.
**Gap:** Plan says "direction-aware vertical slide/fade" based on "relative index" of rail items. This requires:
- Assigning a numeric index to each rail item (Home=0, Planner=1, Courses=2, Saved=3, AI Advisor=4, Avatar=5).
- On tab switch: compare new index vs. old index. If new > old -> slide up (content enters from bottom). If new < old -> slide down (content enters from top).
- This needs JS logic to compute direction and apply `.transition-up` / `.transition-down` classes before triggering the transition.
- Must handle the Planner -> Placeholder transition too (app shell hides, placeholder slides in).
**Resolution:** Add to Phase 2: direction calculation function, CSS classes for both directions, and explicit transition timing.

### GAP 18: No Loading/Spinner State for Recommendations
**Current state:** Form submit disables `#submit-btn` text to "Working..." during the API call. No skeleton or loading state in the results area.
**Gap:** With the new selected-semester model, switching semesters is instant (data already loaded). But the initial `/recommend` call still has no loading skeleton. Plan does not address this. Minor but worth noting for UX completeness.
**Decision locked / Resolution:** Keep current submit-button loading behavior in v1.7 (`Working...` / spinner). Do not add a recommendations shimmer/skeleton in this release.

---

## IA / UX Blueprint
## 1) Left Vertical Rail
1. Replace top nav with left rail.
2. `Planner` opens the live dashboard workspace.
3. `Home`, `Courses`, `Saved`, `AI Advisor`, and `Avatar` open placeholder screens.
4. Active rail item receives yellow highlight and glow.
5. Rail item transitions use vertical directional motion by relative index.
6. **[NEW]** Remove topbar in v1.7. Branding (`marquette_logo.png` + `MarqBot`) lives in the left rail header.
7. **[NEW]** Rail items use consistent element types (all `<button>`, not mixed `<a>` / `<button>`).
8. **[NEW]** Avatar nav button ID: `nav-avatar`. Placeholder screen ID: `placeholder-avatar`. CSS: `.placeholder-screen--avatar` with `--placeholder-cover: url("screen_saved_cover.jpg")`.

## 2) Planner Workspace (2x2 Asymmetric Grid)
1. Top-left: Build Your Plan (current form cluster).
2. Top-right: Academic Dashboard (progress ring/KPIs/current progress).
3. Bottom-left: Settings + Can Take + Degree Summary.
4. Bottom-right: Interactive Recommendations section.
5. **[NEW]** `#section-hero` (welcome header) renders as empty-state in bottom-right quadrant; hidden once results load.
6. **[NEW]** All existing element IDs preserved - elements re-parented into quadrant wrappers, not renamed.
7. **[NEW]** Quadrant containers must use `overflow: visible` to avoid clipping multiselect dropdowns.
8. **[NEW]** Settings controls (`#target-semester`, `#target-semester-2`, `#target-semester-3`, `#max-recs`) must retain `form="advisor-form"` attribute. No new `<form>` wrappers.

## 3) Bottom-Right Recommendations Interactivity
1. Left sub-column: semester selector buttons.
2. Right sub-column: course list for selected semester only.
3. Selector mode adaptation:
   - 1 semester: single larger optimized button
   - 2 semesters: balanced two-button spacing
   - 3 semesters: standard stacked mode
4. Each semester entry has an expand control to open modal.
5. **[NEW]** Rendering decomposition: split `renderRecommendationsHtml` into prefix (Plan Context + Current Progress), selector, and per-semester detail. `renderSemesterHtml()` is reused per-semester.
6. **[NEW]** `app.js` state gains `selectedSemesterIndex` (default 0). Selector clicks re-render the detail pane only.
7. **[NEW]** `clearResults()` must reset `selectedSemesterIndex` to 0 and close any open modal.

## 4) Expanded Modal
1. Centered modal with translucent/blur backdrop.
2. Scrollable content area.
3. Displays full semester detail stack (enlarged cards + progress + timeline + notes/warnings).
4. Close behavior: outside click, `Esc`, explicit close button.
5. **[NEW]** Modal reuses `renderSemesterHtml()` output. Larger cards achieved via CSS-only (`.modal-body .rec-card` overrides). No separate modal renderer.
6. **[NEW]** Focus trap: on modal open, trap focus inside modal. On close, restore focus to the expand button that triggered it. Use `role="dialog"` and `aria-modal="true"`.

## Technical Plan (Phases)
## Phase 1: Layout Foundation
1. Introduce left rail shell + right workspace shell.
2. Re-home existing planner sections into 2x2 regions without behavior changes.
3. Add Avatar placeholder screen markup (`#placeholder-avatar`, `.placeholder-screen--avatar`).
4. **[NEW]** ID Preservation Table:

   | Element | Old Parent | New Quadrant |
   |---------|-----------|-------------|
   | `#advisor-form` (+ all multiselects) | `#panel-left` | Top-left |
   | `#progress-dashboard`, `#progress-ring-wrap`, `#kpi-row` | `#panel-center` | Top-right |
   | `#quick-settings`, `#can-take-section`, `#right-summary` | `#panel-right` | Bottom-left |
   | `#results`, `#section-hero` | `#panel-center` | Bottom-right |

5. **[NEW]** Verify quadrant containers use `overflow: visible`. Test all four multiselect dropdowns for clipping.
6. **[NEW]** Remove topbar and place branding in the rail header.
7. **[NEW]** Remove `updateStepIndicator()` ghost code and `#topbar .step-indicator` CSS rule.

## Phase 2: Navigation Conversion
1. Move current top-nav logic to rail controller.
2. Add `activeNavTab` persistence in session state.
   - `getSessionSnapshot()` gains `activeNavTab` string field.
   - `restoreSession()` gains `callbacks.restoreNavTab(tabId)` callback.
   - Fallback: unknown/missing tab ID -> `"nav-plan"`.
3. Preserve planner runtime state when leaving/returning to Planner.
4. Add direction-aware vertical transition classes.
   - **[NEW]** Assign index per rail item (Home=0 .. Avatar=5).
   - **[NEW]** On switch: compare indices, apply `.transition-up` or `.transition-down` to entering screen.
   - **[NEW]** CSS: define both directional transform origins and timing.
5. **[NEW]** Update `placeholderMap` to include `"nav-avatar": "placeholder-avatar"`.
6. **[NEW]** Normalize all rail items to `<button type="button">` (current `#nav-plan` is an `<a>` tag).
7. **[NEW]** Remove horizontal `#nav-pill-indicator` animation. Use static active-state styling for the rail (no sliding indicator in v1.7).

## Phase 3: Recommendations Interactivity
1. Introduce selected-semester UI state (`state.selectedSemesterIndex`, default 0).
2. Render semester selector rail + selected semester detail pane.
   - **[NEW]** Decompose `renderRecommendationsHtml`: extract prefix block, add `renderSemesterSelectorHtml(semesters)`, reuse `renderSemesterHtml()` for detail pane.
   - **[NEW]** On selector click: swap only the detail pane innerHTML; do not re-render prefix or selector.
3. Add adaptive layout classes for 1/2/3 semester modes.
4. **[NEW]** Update `clearResults()` to reset `selectedSemesterIndex` and close modal.
5. **[NEW]** Preserve can-take dual behavior: `#can-take-input` value still populates `requested_course` on form submit, and standalone Enter still calls `postCanTake()`.

## Phase 4: Modal Experience
1. Add modal container + backdrop layers (`#semester-modal` root in `index.html`).
2. Wire open/close events from semester controls.
3. Render full semester detail payload in expanded mode (reuse `renderSemesterHtml()` output, CSS-enlarged).
4. **[NEW]** Implement focus trap: on open, move focus into modal; on close, return focus to trigger.
5. **[NEW]** Add `role="dialog"`, `aria-modal="true"`, `aria-labelledby` pointing to a semester heading inside the modal.
6. **[NEW]** Ensure Escape key closes modal even when focus is inside form elements within the modal.

## Phase 5: Visual Polish
1. Tighten spacing rhythm and card distinction.
2. Keep backgrounds and translucent layering consistent with current theme.
3. Separate macro transition easing from micro-hover interactions.
4. **[NEW]** Re-test background orbs (`bg-orb-a`, `bg-orb-b`) and `bg-grid` visual alignment against new rail layout.
5. **[NEW]** Verify all design tokens still apply: `--panel-left`, `--panel-right` custom properties may need renaming or new quadrant equivalents.

## Phase 6: Regression + Hardening
1. Validate major UI flows (form submit, recommendations, can-take, tab switching).
2. Update/add frontend tests for rail, selector behavior, and modal controls.
3. Confirm all existing recommendation metadata remains visible and accurate.
4. **[NEW]** Explicit test update checklist:
   - Update nav order tests to include Avatar (6 items, not 5).
   - Update nav container selector (topbar `.anchor-nav` -> rail container).
   - Add `#placeholder-avatar` and `.placeholder-screen--avatar` to placeholder tests.
   - Add modal container existence test (`#semester-modal`).
   - Add semester selector rendering tests (1/2/3 semester modes).
   - Add modal open/close/focus-trap tests.
   - Add rail keyboard navigation tests (arrow key cycling).
   - Verify rendering.js tests still pass unchanged (pure functions).
   - Add session `activeNavTab` persistence/restore round-trip test.

## Responsive Behavior Spec (NEW)

> The original plan lacked responsive breakpoint definitions for the new layout.

| Breakpoint | Rail | Planner Grid | Notes |
|-----------|------|-------------|-------|
| >1200px (desktop) | Full vertical rail, text labels, ~180px wide | 2x2 asymmetric (33/67 top, 50/50 or similar bottom) | Primary layout |
| 900-1200px (tablet) | Vertical rail, compact text-only labels (~120px) | Single-column stack (form -> dashboard -> settings -> recs) | Rail stays visible |
| <900px (mobile) | Collapses to horizontal bottom tab bar (text+label) | Single-column stack | Rail uses six compact text+label items |
| <700px (small mobile) | Same as <900px, reduced padding | Same | Padding/margin tightening |

**Rail collapse detail:**
- At <900px, a full vertical rail consumes too much horizontal space (180px of 360px = 50%).
- Use a bottom tab bar with 6 text+label items and gold active state.
- No hamburger/off-canvas alternative in v1.7.

## Public Interface / Compatibility Notes
1. Backend API schemas remain unchanged.
2. Frontend DOM contracts should preserve existing key IDs for current handlers and tests.
3. Session model extends with `activeNavTab`; older sessions should fall back gracefully.
4. **[NEW]** `STORAGE_KEY` stays `"marqbot_session_v1"` - no key bump needed since `restoreSession` ignores unknown fields.
5. **[NEW]** `form="advisor-form"` attribute on settings controls is a load-bearing contract. Must not be broken.

## Planned File Touch Map (Implementation Stage)
1. `frontend/index.html` (layout shells, rail markup, modal root, placeholders, Avatar screen)
2. `frontend/style.css` (rail/grid/modal/transition styles, responsive breakpoints, remove old topbar nav styles)
3. `frontend/app.js` (rail routing state, selected-semester state, modal controller, `clearResults()` update, remove `updateStepIndicator()` ghost code)
4. `frontend/modules/session.js` (persist/restore active nav tab)
5. `frontend/modules/rendering.js` (decompose `renderRecommendationsHtml`, add `renderSemesterSelectorHtml`)
6. `tests/frontend_tests/static_ui_contract.test.js` (update nav tests, add Avatar/modal/rail tests)
7. Additional frontend interaction tests (rail/modal/semester selection/keyboard)
8. `docs/PROJECT_HISTORY.md` (implementation history entry after execution)

## Acceptance Criteria
1. Left rail with exact locked item order is implemented and interactive.
2. Planner opens 2x2 dashboard layout with 33/67 left/right balance.
3. All non-Planner rail items open placeholder screens.
4. Avatar item exists at rail bottom and opens coming-soon screen.
5. Recommendations panel supports selectable semester interaction.
6. Selector layout adapts for 1/2/3 semester response modes.
7. Expand control opens scrollable modal with full semester details.
8. Modal close mechanisms (`outside`, `Esc`, close button) all function.
9. Existing recommendation metadata fidelity is preserved end-to-end.
10. Existing API requests/responses remain compatible.
11. **[NEW]** Modal has focus trap and correct ARIA attributes.
12. **[NEW]** Rail keyboard navigation works (arrow keys cycle items).
13. **[NEW]** Session `activeNavTab` persists and restores across page loads.
14. **[NEW]** All multiselect dropdowns are visible (not clipped) in new grid quadrants.
15. **[NEW]** Responsive layout degrades gracefully at all breakpoints (desktop/tablet/mobile).

## Risks and Mitigations
1. UI density risk in modal/details:
   - Mitigate with minimum font/spacing guards and structured card hierarchy.
2. Refactor breaks event bindings:
   - Mitigate by preserving key IDs and staged migration.
3. Modal state complexity:
   - Mitigate with single modal controller and explicit selected-semester state.
4. Style drift from Marquette identity:
   - Mitigate by reusing existing visual tokens/background/translucent patterns.
5. **[NEW]** Multiselect dropdown clipping in grid quadrants:
   - Mitigate by enforcing `overflow: visible` on grid cells; test all dropdowns post-layout.
6. **[NEW]** Test suite churn from layout restructure:
   - Mitigate by updating tests in same commit as the HTML changes (atomic commits).
7. **[NEW]** Responsive rail collapse complexity:
   - Mitigate by choosing one collapse strategy (bottom tab bar) and implementing it cleanly. Do not support multiple collapse modes.
8. **[NEW]** `renderRecommendationsHtml` decomposition may break rendering.test.js:
   - Mitigate by keeping the original function as a facade that calls the new sub-functions. Tests call the facade and pass unchanged.

## Execution Notes
1. This is a decision-complete implementation blueprint.
2. Implementation should proceed in phased commits (layout/nav, recommendations/modal, tests/docs).
3. This document should be updated if any scope decisions change before coding begins.



